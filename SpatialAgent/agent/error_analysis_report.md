# Train Set 評估錯誤分析報告

## 📊 總體表現

- **總樣本數**: 1000
- **正確**: 547 (54.7%)
- **錯誤**: 453 (45.3%)

## 🔍 按類別分析

| 類別 | 正確率 | 錯誤數 | 主要問題 |
|------|--------|--------|----------|
| **left_right** | 91.2% | 11/125 | 表現最好 |
| **mcq** | 60.6% | 87/221 | 格式問題 |
| **distance** | 58.1% | 216/515 | 距離誤差 |
| **count** | 0.0% | 139/139 | **完全失敗** |

## ⚠️ 主要錯誤類型

### 1. No Valid Action (131 個)
**問題**: LLM 沒有正確輸出 `<execute>` 或 `<answer>` 標籤

**可能原因**:
- Prompt 格式說明不夠明確
- vLLM 模型對格式要求理解不足
- 需要更多範例

**改進建議**:
- 加強 prompt 中格式說明
- 增加更多範例
- 考慮使用 think_mode
- 改進錯誤處理，允許重試

### 2. Mask Not Found (99 個)
**問題**: 函數調用中引用的 mask 不存在

**已修復**: ✅ mask 解析邏輯已改進，現在可以正確處理 train set 的 `<mask>` 格式

**改進建議**:
- 確保 mask 命名一致性
- 在 prompt 中明確列出可用的 masks

### 3. 距離誤差 (109 個)
**問題**: 距離預測不準確

**誤差分布**:
- 大誤差 (>5m): 21 個
- 中等誤差 (2-5m): 40 個
- 小誤差 (<2m): 48 個

**可能原因**:
- 距離估計模型在遠距離時精度下降
- LLM 選擇了錯誤的物體對
- 級聯策略可能導致誤差累積

**改進建議**:
- 檢查距離估計模型的性能
- 改進級聯策略
- 增加距離驗證邏輯
- 考慮使用多個距離估計並取平均

### 4. Count 問題 (139 個 - 100% 失敗)
**問題**: 所有 count 問題都失敗

**錯誤類型分布**:
- mask_not_found: 61 個
- no_valid_action: 34 個
- other: 35 個
- wrong_prediction: 6 個
- decode_mask_error: 3 個

**可能原因**:
- Count 問題通常涉及多個物體和複雜條件
- 需要多次函數調用才能完成
- Prompt 可能沒有明確說明如何計數

**改進建議**:
- 創建專門的 count 函數
- 改進 prompt，明確說明計數步驟
- 增加 count 問題的範例
- 檢查 mask 解析是否正確處理複雜情況

## 💡 改進優先級

### 高優先級
1. **修復 Count 問題** (0% 準確率)
   - 改進 mask 解析（✅ 已完成）
   - 創建專門的計數邏輯
   - 改進 prompt

2. **減少 No Valid Action 錯誤** (131 個)
   - 加強格式說明
   - 增加範例
   - 改進錯誤處理

### 中優先級
3. **改進距離估計精度**
   - 檢查模型性能
   - 改進級聯策略

4. **減少 Mask Not Found** (✅ 已修復 mask 解析)

### 低優先級
5. **優化 MCQ 和 left_right** (已經表現不錯)

## 📈 預期改進效果

修復 mask 解析後，預期可以解決：
- ~99 個 mask_not_found 錯誤
- 部分 count 問題錯誤

改進 prompt 和錯誤處理後，預期可以解決：
- ~50-80 個 no_valid_action 錯誤

**預期準確率**: 60-70% (從 54.7% 提升)

## 🔧 下一步行動

1. ✅ 修復 mask 解析邏輯
2. 改進 prompt，加強格式說明
3. 創建專門的 count 函數
4. 改進錯誤處理和重試機制
5. 重新評估並分析改進效果

